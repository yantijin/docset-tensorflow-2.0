<div itemscope itemtype="http://developers.google.com/ReferenceObject">
<meta itemprop="name" content="tf.keras.metrics.Metric" />
<meta itemprop="path" content="Stable" />
<meta itemprop="property" content="__init__"/>
<meta itemprop="property" content="__new__"/>
<meta itemprop="property" content="add_weight"/>
<meta itemprop="property" content="reset_states"/>
<meta itemprop="property" content="result"/>
<meta itemprop="property" content="update_state"/>
</div>


<h1>tf.keras.metrics.Metric</h1>

<!-- Insert buttons -->




<table class="tfo-notebook-buttons tfo-api" align="left">
</table>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<h2>Class <code>Metric</code></h2>

<!-- Start diff -->


<p>Encapsulates metric logic and state.</p>

<p>Inherits From: <a href="../../../tf/keras/layers/Layer.html"><code>Layer</code></a></p>

<h3>Aliases:</h3>

<ul>
<li>Class <code>tf.compat.v1.keras.metrics.Metric</code></li>
<li>Class <code>tf.compat.v2.keras.metrics.Metric</code></li>
<li>Class <code>tf.compat.v2.metrics.Metric</code></li>
<li>Class <code>tf.metrics.Metric</code></li>
</ul>


<!-- Placeholder for "Used in" -->


<h4>Usage:</h4>

<p><code>python
m = SomeMetric(...)
for input in ...:
  m.update_state(input)
print('Final result: ', m.result().numpy())
</code></p>

<p>Usage with tf.keras API:</p>

<p>```python
model = tf.keras.Sequential()
model.add(tf.keras.layers.Dense(64, activation=&lsquo;relu&rsquo;))
model.add(tf.keras.layers.Dense(64, activation=&lsquo;relu&rsquo;))
model.add(tf.keras.layers.Dense(10, activation=&lsquo;softmax&rsquo;))</p>

<p>model.compile(optimizer=tf.compat.v1.train.RMSPropOptimizer(0.01),
              loss=tf.keras.losses.categorical_crossentropy,
              metrics=[tf.keras.metrics.CategoricalAccuracy()])</p>

<p>data = np.random.random((1000, 32))
labels = np.random.random((1000, 10))</p>

<p>dataset = tf.data.Dataset.from_tensor_slices((data, labels))
dataset = dataset.batch(32)
dataset = dataset.repeat()</p>

<p>model.fit(dataset, epochs=10, steps_per_epoch=30)
```</p>

<p>To be implemented by subclasses:
* <code>__init__()</code>: All state variables should be created in this method by
  calling <code>self.add_weight()</code> like: <code>self.var = self.add_weight(...)</code>
* <code>update_state()</code>: Has all updates to the state variables like:
  self.var.assign_add(&hellip;).
* <code>result()</code>: Computes and returns a value for the metric
  from the state variables.</p>

<p>Example subclass implementation:</p>

<p>```
class BinaryTruePositives(tf.keras.metrics.Metric):</p>

<p>  def <strong>init</strong>(self, name=&lsquo;binary_true_positives&rsquo;, <strong>kwargs):
    super(BinaryTruePositives, self).<strong>init</strong>(name=name, </strong>kwargs)
    self.true_positives = self.add_weight(name=&lsquo;tp&rsquo;, initializer=&lsquo;zeros&rsquo;)</p>

<p>  def update_state(self, y_true, y_pred, sample_weight=None):
    y_true = tf.cast(y_true, tf.bool)
    y_pred = tf.cast(y_pred, tf.bool)</p>

<pre><code>values = tf.logical_and(tf.equal(y_true, True), tf.equal(y_pred, True))
values = tf.cast(values, self.dtype)
if sample_weight is not None:
  sample_weight = tf.cast(sample_weight, self.dtype)
  sample_weight = tf.broadcast_weights(sample_weight, values)
  values = tf.multiply(values, sample_weight)
self.true_positives.assign_add(tf.reduce_sum(values))
</code></pre>

<p>  def result(self):
    return self.true_positives
```</p>

<h2 id="__init__"><code>__init__</code></h2>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
__init__(
    name=None,
    dtype=None,
    **kwargs
)
</code></p>

<h2 id="__new__"><code>__new__</code></h2>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
@staticmethod
__new__(
    cls,
    *args,
    **kwargs
)
</code></p>

<p>Create and return a new object.  See help(type) for accurate signature.</p>

<h2>Methods</h2>

<h3 id="add_weight"><code>add_weight</code></h3>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
add_weight(
    name,
    shape=(),
    aggregation=tf.compat.v1.VariableAggregation.SUM,
    synchronization=tf.VariableSynchronization.ON_READ,
    initializer=None,
    dtype=None
)
</code></p>

<p>Adds state variable. Only for use by subclasses.</p>

<h3 id="reset_states"><code>reset_states</code></h3>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
reset_states()
</code></p>

<p>Resets all of the metric state variables.</p>

<p>This function is called between epochs/steps,
when a metric is evaluated during training.</p>

<h3 id="result"><code>result</code></h3>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
result()
</code></p>

<p>Computes and returns the metric value tensor.</p>

<p>Result computation is an idempotent operation that simply calculates the
metric value using the state variables.</p>

<h3 id="update_state"><code>update_state</code></h3>


<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>

<p><code>python
update_state(
    *args,
    **kwargs
)
</code></p>

<p>Accumulates statistics for the metric.</p>

<p>Note: This function is executed as a graph function in graph mode.
This means:
  a) Operations on the same resource are executed in textual order.
     This should make it easier to do things like add the updated
     value of a variable to another, for example.
  b) You don&rsquo;t need to worry about collecting the update ops to execute.
     All update ops added to the graph by this function will be executed.
  As a result, code should generally work the same way with graph or
  eager execution.</p>

<p>Please use <a href="../../../tf/config/experimental_run_functions_eagerly.html"><code>tf.config.experimental_run_functions_eagerly(True)</code></a> to execute
this function eagerly for debugging or profiling.</p>

<h4>Args:</h4>

<ul>
<li><b><code>*args</code></b>: * <b><code>**kwargs</code></b>: A mini-batch of inputs to the Metric.</li>
</ul>

