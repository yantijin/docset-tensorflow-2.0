
    <html lang="zh-cn">
    <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <link href=../../../../default.css" rel="stylesheet">
    <link href="
   ../../../../github.css" rel="stylesheet">
    </head>
    <body>
    <div itemscope itemtype="http://developers.google.com/ReferenceObject">
<meta itemprop="name" content="tf.keras.metrics.Metric" />
<meta itemprop="path" content="Stable" />
<meta itemprop="property" content="__init__"/>
<meta itemprop="property" content="__new__"/>
<meta itemprop="property" content="add_weight"/>
<meta itemprop="property" content="reset_states"/>
<meta itemprop="property" content="result"/>
<meta itemprop="property" content="update_state"/>
</div>

<h1 id="tfkerasmetricsmetric">tf.keras.metrics.Metric</h1>
<!-- Insert buttons -->

<table class="tfo-notebook-buttons tfo-api" align="left">
</table>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<h2 id="class-metric">Class <code>Metric</code></h2>
<!-- Start diff -->

<p>Encapsulates metric logic and state.</p>
<p>Inherits From: <a href="../../../tf/keras/layers/Layer.html"><code>Layer</code></a></p>
<h3 id="aliases">Aliases:</h3>
<ul>
<li>Class <code>tf.compat.v1.keras.metrics.Metric</code></li>
<li>Class <code>tf.compat.v2.keras.metrics.Metric</code></li>
<li>Class <code>tf.compat.v2.metrics.Metric</code></li>
<li>Class <code>tf.metrics.Metric</code></li>
</ul>
<!-- Placeholder for "Used in" -->

<h4 id="usage">Usage:</h4>
<div class="codehilite"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">SomeMetric</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="o">...</span><span class="p">:</span>
  <span class="n">m</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final result: &#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>


<p>Usage with tf.keras API:</p>
<div class="codehilite"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">RMSPropOptimizer</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">categorical_crossentropy</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">CategoricalAccuracy</span><span class="p">()])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>


<p>To be implemented by subclasses:
* <code>__init__()</code>: All state variables should be created in this method by
  calling <code>self.add_weight()</code> like: <code>self.var = self.add_weight(...)</code>
* <code>update_state()</code>: Has all updates to the state variables like:
  self.var.assign_add(...).
* <code>result()</code>: Computes and returns a value for the metric
  from the state variables.</p>
<p>Example subclass implementation:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="n">BinaryTruePositives</span>(<span class="n">tf</span>.<span class="n">keras</span>.<span class="n">metrics</span>.<span class="n">Metric</span>):

  <span class="n">def</span> <span class="n">__init__</span>(<span class="k">self</span>, <span class="nb">name</span>=<span class="s">&#39;binary_true_positives&#39;</span>, **<span class="n">kwargs</span>):
    <span class="n">super</span>(<span class="n">BinaryTruePositives</span>, <span class="k">self</span>).<span class="n">__init__</span>(<span class="nb">name</span>=<span class="nb">name</span>, **<span class="n">kwargs</span>)
    <span class="k">self</span>.<span class="n">true_positives</span> = <span class="k">self</span>.<span class="n">add_weight</span>(<span class="nb">name</span>=<span class="s">&#39;tp&#39;</span>, <span class="n">initializer</span>=<span class="s">&#39;zeros&#39;</span>)

  <span class="n">def</span> <span class="n">update_state</span>(<span class="k">self</span>, <span class="n">y_true</span>, <span class="n">y_pred</span>, <span class="n">sample_weight</span>=<span class="n">None</span>):
    <span class="n">y_true</span> = <span class="n">tf</span>.<span class="n">cast</span>(<span class="n">y_true</span>, <span class="n">tf</span>.<span class="nb">bool</span>)
    <span class="n">y_pred</span> = <span class="n">tf</span>.<span class="n">cast</span>(<span class="n">y_pred</span>, <span class="n">tf</span>.<span class="nb">bool</span>)

    <span class="nb">values</span> = <span class="n">tf</span>.<span class="n">logical_and</span>(<span class="n">tf</span>.<span class="n">equal</span>(<span class="n">y_true</span>, <span class="nb">True</span>), <span class="n">tf</span>.<span class="n">equal</span>(<span class="n">y_pred</span>, <span class="nb">True</span>))
    <span class="nb">values</span> = <span class="n">tf</span>.<span class="n">cast</span>(<span class="nb">values</span>, <span class="k">self</span>.<span class="n">dtype</span>)
    <span class="k">if</span> <span class="n">sample_weight</span> <span class="k">is</span> <span class="nb">not</span> <span class="n">None:</span>
      <span class="n">sample_weight</span> = <span class="n">tf</span>.<span class="n">cast</span>(<span class="n">sample_weight</span>, <span class="k">self</span>.<span class="n">dtype</span>)
      <span class="n">sample_weight</span> = <span class="n">tf</span>.<span class="n">broadcast_weights</span>(<span class="n">sample_weight</span>, <span class="nb">values</span>)
      <span class="nb">values</span> = <span class="n">tf</span>.<span class="n">multiply</span>(<span class="nb">values</span>, <span class="n">sample_weight</span>)
    <span class="k">self</span>.<span class="n">true_positives</span>.<span class="n">assign_add</span>(<span class="n">tf</span>.<span class="n">reduce_sum</span>(<span class="nb">values</span>))

  <span class="n">def</span> <span class="n">result</span>(<span class="k">self</span>):
    <span class="k">return</span> <span class="k">self</span>.<span class="n">true_positives</span>
</pre></div>


<h2 id="__init__"><code>__init__</code></h2>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="fm">__init__</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</pre></div>


<h2 id="__new__"><code>__new__</code></h2>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="fm">__new__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</pre></div>


<p>Create and return a new object.  See help(type) for accurate signature.</p>
<h2 id="methods">Methods</h2>
<h3 id="add_weight"><code>add_weight</code></h3>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">add_weight</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">aggregation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">VariableAggregation</span><span class="o">.</span><span class="n">SUM</span><span class="p">,</span>
    <span class="n">synchronization</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">VariableSynchronization</span><span class="o">.</span><span class="n">ON_READ</span><span class="p">,</span>
    <span class="n">initializer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Adds state variable. Only for use by subclasses.</p>
<h3 id="reset_states"><code>reset_states</code></h3>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">reset_states</span><span class="p">()</span>
</pre></div>


<p>Resets all of the metric state variables.</p>
<p>This function is called between epochs/steps,
when a metric is evaluated during training.</p>
<h3 id="result"><code>result</code></h3>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">result</span><span class="p">()</span>
</pre></div>


<p>Computes and returns the metric value tensor.</p>
<p>Result computation is an idempotent operation that simply calculates the
metric value using the state variables.</p>
<h3 id="update_state"><code>update_state</code></h3>

<p><a target="_blank" href="/code/stable/tensorflow/python/keras/metrics.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">update_state</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</pre></div>


<p>Accumulates statistics for the metric.</p>
<p>Note: This function is executed as a graph function in graph mode.
This means:
  a) Operations on the same resource are executed in textual order.
     This should make it easier to do things like add the updated
     value of a variable to another, for example.
  b) You don't need to worry about collecting the update ops to execute.
     All update ops added to the graph by this function will be executed.
  As a result, code should generally work the same way with graph or
  eager execution.</p>
<p>Please use <a href="../../../tf/config/experimental_run_functions_eagerly.html"><code>tf.config.experimental_run_functions_eagerly(True)</code></a> to execute
this function eagerly for debugging or profiling.</p>
<h4 id="args">Args:</h4>
<ul>
<li><b><code>*args</code></b>: * <b><code>**kwargs</code></b>: A mini-batch of inputs to the Metric.</li>
</ul>
    </body>
    </html>
   