<div itemscope itemtype="http://developers.google.com/ReferenceObject">
<meta itemprop="name" content="tf.estimator.classifier_parse_example_spec" />
<meta itemprop="path" content="Stable" />
</div>


<h1>tf.estimator.classifier_parse_example_spec</h1>

<!-- Insert buttons -->




<table class="tfo-notebook-buttons tfo-api" align="left">

<td>
  <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/parsing_utils.py">
    <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" />
    View source on GitHub
  </a>
</td></table>




<!-- Start diff -->


<p>Generates parsing spec for tf.parse_example to be used with classifiers.</p>

<h3>Aliases:</h3>

<ul>
<li><code>tf.compat.v2.estimator.classifier_parse_example_spec</code></li>
</ul>


<p><code>python
tf.estimator.classifier_parse_example_spec(
    feature_columns,
    label_key,
    label_dtype=tf.dtypes.int64,
    label_default=None,
    weight_column=None
)
</code></p>

<!-- Placeholder for "Used in" -->


<p>If users keep data in tf.Example format, they need to call tf.parse_example
with a proper feature spec. There are two main things that this utility helps:</p>

<ul>
<li>Users need to combine parsing spec of features with labels and weights
(if any) since they are all parsed from same tf.Example instance. This
utility combines these specs.</li>
<li>It is difficult to map expected label by a classifier such as
<code>DNNClassifier</code> to corresponding tf.parse_example spec. This utility encodes
it by getting related information from users (key, dtype).</li>
</ul>


<p>Example output of parsing spec:</p>

<p>```python</p>

<h1>Define features and transformations</h1>

<p>feature_b = tf.feature_column.numeric_column(&hellip;)
feature_c_bucketized = tf.feature_column.bucketized_column(
  tf.feature_column.numeric_column(&ldquo;feature_c&rdquo;), &hellip;)
feature_a_x_feature_c = tf.feature_column.crossed_column(
    columns=[&ldquo;feature_a&rdquo;, feature_c_bucketized], &hellip;)</p>

<p>feature_columns = [feature_b, feature_c_bucketized, feature_a_x_feature_c]
parsing_spec = tf.estimator.classifier_parse_example_spec(
    feature_columns, label_key=&lsquo;my-label&rsquo;, label_dtype=tf.string)</p>

<h1>For the above example, classifier_parse_example_spec would return the dict:</h1>

<p>assert parsing_spec == {
  &ldquo;feature_a&rdquo;: parsing_ops.VarLenFeature(tf.string),
  &ldquo;feature_b&rdquo;: parsing_ops.FixedLenFeature([1], dtype=tf.float32),
  &ldquo;feature_c&rdquo;: parsing_ops.FixedLenFeature([1], dtype=tf.float32)
  &ldquo;my-label&rdquo; : parsing_ops.FixedLenFeature([1], dtype=tf.string)
}
```</p>

<p>Example usage with a classifier:</p>

<p>```python
feature_columns = # define features via tf.feature_column
estimator = DNNClassifier(
    n_classes=1000,
    feature_columns=feature_columns,
    weight_column=&lsquo;example-weight&rsquo;,
    label_vocabulary=[&lsquo;photos&rsquo;, &lsquo;keep&rsquo;, &hellip;],
    hidden_units=[256, 64, 16])</p>

<h1>This label configuration tells the classifier the following:</h1>

<h1>* weights are retrieved with key &lsquo;example-weight&rsquo;</h1>

<h1>* label is string and can be one of the following [&lsquo;photos&rsquo;, &lsquo;keep&rsquo;, &hellip;]</h1>

<h1>* integer id for label &lsquo;photos&rsquo; is 0, &lsquo;keep&rsquo; is 1, &hellip;</h1>

<h1>Input builders</h1>

<p>def input_fn_train():  # Returns a tuple of features and labels.
  features = tf.contrib.learn.read_keyed_batch_features(
      file_pattern=train_files,
      batch_size=batch_size,
      # creates parsing configuration for tf.parse_example
      features=tf.estimator.classifier_parse_example_spec(
          feature_columns,
          label_key=&lsquo;my-label&rsquo;,
          label_dtype=tf.string,
          weight_column=&lsquo;example-weight&rsquo;),
      reader=tf.RecordIOReader)
   labels = features.pop(&lsquo;my-label&rsquo;)
   return features, labels</p>

<p>estimator.train(input_fn=input_fn_train)
```</p>

<h4>Args:</h4>

<ul>
<li><b><code>feature_columns</code></b>: An iterable containing all feature columns. All items
should be instances of classes derived from <code>FeatureColumn</code>.</li>
<li><b><code>label_key</code></b>: A string identifying the label. It means tf.Example stores labels
with this key.</li>
<li><b><code>label_dtype</code></b>: A <code>tf.dtype</code> identifies the type of labels. By default it is
<a href="../../tf.html#int64"><code>tf.int64</code></a>. If user defines a <code>label_vocabulary</code>, this should be set as
<a href="../../tf.html#string"><code>tf.string</code></a>. <a href="../../tf.html#float32"><code>tf.float32</code></a> labels are only supported for binary
classification.</li>
<li><b><code>label_default</code></b>: used as label if label_key does not exist in given
tf.Example. An example usage: let&rsquo;s say <code>label_key</code> is &lsquo;clicked&rsquo; and
tf.Example contains clicked data only for positive examples in following
format <code>key:clicked, value:1</code>. This means that if there is no data with
key &lsquo;clicked&rsquo; it should count as negative example by setting
<code>label_deafault=0</code>. Type of this value should be compatible with
<code>label_dtype</code>.</li>
<li><b><code>weight_column</code></b>: A string or a <code>NumericColumn</code> created by
<a href="../../tf/feature_column/numeric_column.html"><code>tf.feature_column.numeric_column</code></a> defining feature column representing
weights. It is used to down weight or boost examples during training. It
will be multiplied by the loss of the example. If it is a string, it is
used as a key to fetch weight tensor from the <code>features</code>. If it is a
<code>NumericColumn</code>, raw tensor is fetched by key <code>weight_column.key</code>,
then weight_column.normalizer_fn is applied on it to get weight tensor.</li>
</ul>


<h4>Returns:</h4>

<p>A dict mapping each feature key to a <code>FixedLenFeature</code> or <code>VarLenFeature</code>
value.</p>

<h4>Raises:</h4>

<ul>
<li><b><code>ValueError</code></b>: If label is used in <code>feature_columns</code>.</li>
<li><b><code>ValueError</code></b>: If weight_column is used in <code>feature_columns</code>.</li>
<li><b><code>ValueError</code></b>: If any of the given <code>feature_columns</code> is not a <code>_FeatureColumn</code>
instance.</li>
<li><b><code>ValueError</code></b>: If <code>weight_column</code> is not a <code>NumericColumn</code> instance.</li>
<li><b><code>ValueError</code></b>: if label_key is None.</li>
</ul>

