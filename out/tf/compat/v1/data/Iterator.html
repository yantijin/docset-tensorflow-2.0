
    <html lang="zh-cn">
    <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <link href="../../../../../default.css" rel="stylesheet">
    <link href="
   ../../../../../github.css" rel="stylesheet">
    </head>
    <body>
    <div itemscope itemtype="http://developers.google.com/ReferenceObject">
<meta itemprop="name" content="tf.compat.v1.data.Iterator" />
<meta itemprop="path" content="Stable" />
<meta itemprop="property" content="element_spec"/>
<meta itemprop="property" content="initializer"/>
<meta itemprop="property" content="output_classes"/>
<meta itemprop="property" content="output_shapes"/>
<meta itemprop="property" content="output_types"/>
<meta itemprop="property" content="__init__"/>
<meta itemprop="property" content="from_string_handle"/>
<meta itemprop="property" content="from_structure"/>
<meta itemprop="property" content="get_next"/>
<meta itemprop="property" content="make_initializer"/>
<meta itemprop="property" content="string_handle"/>
</div>

<h1 id="tfcompatv1dataiterator">tf.compat.v1.data.Iterator</h1>
<!-- Insert buttons -->

<table class="tfo-notebook-buttons tfo-api" align="left">
</table>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<h2 id="class-iterator">Class <code>Iterator</code></h2>
<!-- Start diff -->

<p>Represents the state of iterating through a <code>Dataset</code>.</p>
<!-- Placeholder for "Used in" -->

<h2 id="__init__"><code>__init__</code></h2>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="fm">__init__</span><span class="p">(</span>
    <span class="n">iterator_resource</span><span class="p">,</span>
    <span class="n">initializer</span><span class="p">,</span>
    <span class="n">output_types</span><span class="p">,</span>
    <span class="n">output_shapes</span><span class="p">,</span>
    <span class="n">output_classes</span>
<span class="p">)</span>
</pre></div>


<p>Creates a new iterator from the given iterator resource.</p>
<p>Note: Most users will not call this initializer directly, and will
instead use <code>Dataset.make_initializable_iterator()</code> or
<code>Dataset.make_one_shot_iterator()</code>.</p>
<h4 id="args">Args:</h4>
<ul>
<li><b><code>iterator_resource</code></b>: A <a href="../../../../tf.html#resource"><code>tf.resource</code></a> scalar <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> representing the
  iterator.</li>
<li><b><code>initializer</code></b>: A <a href="../../../../tf/Operation.html"><code>tf.Operation</code></a> that should be run to initialize this
  iterator.</li>
<li><b><code>output_types</code></b>: A nested structure of <a href="../../../../tf/dtypes/DType.html"><code>tf.DType</code></a> objects corresponding to
  each component of an element of this iterator.</li>
<li><b><code>output_shapes</code></b>: A nested structure of <a href="../../../../tf/TensorShape.html"><code>tf.TensorShape</code></a> objects
  corresponding to each component of an element of this iterator.</li>
<li><b><code>output_classes</code></b>: A nested structure of Python <code>type</code> objects corresponding
  to each component of an element of this iterator.</li>
</ul>
<h2 id="properties">Properties</h2>
<h3 id="element_spec"><code>element_spec</code></h3>

<p>The type specification of an element of this iterator.</p>
<h4 id="returns">Returns:</h4>
<p>A nested structure of <a href="../../../../tf/TypeSpec.html"><code>tf.TypeSpec</code></a> objects matching the structure of an
element of this iterator and specifying the type of individual components.</p>
<h3 id="initializer"><code>initializer</code></h3>

<p>A <a href="../../../../tf/Operation.html"><code>tf.Operation</code></a> that should be run to initialize this iterator.</p>
<h4 id="returns_1">Returns:</h4>
<p>A <a href="../../../../tf/Operation.html"><code>tf.Operation</code></a> that should be run to initialize this iterator</p>
<h4 id="raises">Raises:</h4>
<ul>
<li><b><code>ValueError</code></b>: If this iterator initializes itself automatically.</li>
</ul>
<h3 id="output_classes"><code>output_classes</code></h3>

<p>Returns the class of each component of an element of this iterator. (deprecated)</p>
<p>Warning: THIS FUNCTION IS DEPRECATED. It will be removed in a future version.
Instructions for updating:
Use <a href="../../../../tf/compat/v1/data/get_output_classes.html"><code>tf.compat.v1.data.get_output_classes(iterator)</code></a>.</p>
<p>The expected values are <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> and <a href="../../../../tf/sparse/SparseTensor.html"><code>tf.SparseTensor</code></a>.</p>
<h4 id="returns_2">Returns:</h4>
<p>A nested structure of Python <code>type</code> objects corresponding to each
component of an element of this dataset.</p>
<h3 id="output_shapes"><code>output_shapes</code></h3>

<p>Returns the shape of each component of an element of this iterator. (deprecated)</p>
<p>Warning: THIS FUNCTION IS DEPRECATED. It will be removed in a future version.
Instructions for updating:
Use <a href="../../../../tf/compat/v1/data/get_output_shapes.html"><code>tf.compat.v1.data.get_output_shapes(iterator)</code></a>.</p>
<h4 id="returns_3">Returns:</h4>
<p>A nested structure of <a href="../../../../tf/TensorShape.html"><code>tf.TensorShape</code></a> objects corresponding to each
component of an element of this dataset.</p>
<h3 id="output_types"><code>output_types</code></h3>

<p>Returns the type of each component of an element of this iterator. (deprecated)</p>
<p>Warning: THIS FUNCTION IS DEPRECATED. It will be removed in a future version.
Instructions for updating:
Use <a href="../../../../tf/compat/v1/data/get_output_types.html"><code>tf.compat.v1.data.get_output_types(iterator)</code></a>.</p>
<h4 id="returns_4">Returns:</h4>
<p>A nested structure of <a href="../../../../tf/dtypes/DType.html"><code>tf.DType</code></a> objects corresponding to each component
of an element of this dataset.</p>
<h2 id="methods">Methods</h2>
<h3 id="from_string_handle"><code>from_string_handle</code></h3>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="n">from_string_handle</span><span class="p">(</span>
    <span class="n">string_handle</span><span class="p">,</span>
    <span class="n">output_types</span><span class="p">,</span>
    <span class="n">output_shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_classes</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Creates a new, uninitialized <code>Iterator</code> based on the given handle.</p>
<p>This method allows you to define a "feedable" iterator where you can choose
between concrete iterators by feeding a value in a <code>tf.Session.run</code> call.
In that case, <code>string_handle</code> would be a <a href="../../../../tf/compat/v1/placeholder.html"><code>tf.compat.v1.placeholder</code></a>, and you
would
feed it with the value of <code>tf.data.Iterator.string_handle</code> in each step.</p>
<p>For example, if you had two iterators that marked the current position in
a training dataset and a test dataset, you could choose which to use in
each step as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">train_iterator</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">train_iterator_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="o">.</span><span class="n">string_handle</span><span class="p">())</span>

<span class="n">test_iterator</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span>
<span class="n">test_iterator_handle</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_iterator</span><span class="o">.</span><span class="n">string_handle</span><span class="p">())</span>

<span class="n">handle</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[])</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Iterator</span><span class="o">.</span><span class="n">from_string_handle</span><span class="p">(</span>
    <span class="n">handle</span><span class="p">,</span> <span class="n">train_iterator</span><span class="o">.</span><span class="n">output_types</span><span class="p">)</span>

<span class="n">next_element</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">next_element</span><span class="p">)</span>

<span class="n">train_loss</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">train_iterator_handle</span><span class="p">})</span>
<span class="n">test_loss</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">handle</span><span class="p">:</span> <span class="n">test_iterator_handle</span><span class="p">})</span>
</pre></div>


<h4 id="args_1">Args:</h4>
<ul>
<li><b><code>string_handle</code></b>: A scalar <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> of type <a href="../../../../tf.html#string"><code>tf.string</code></a> that evaluates to
  a handle produced by the <code>Iterator.string_handle()</code> method.</li>
<li><b><code>output_types</code></b>: A nested structure of <a href="../../../../tf/dtypes/DType.html"><code>tf.DType</code></a> objects corresponding to
  each component of an element of this dataset.</li>
<li><b><code>output_shapes</code></b>: (Optional.) A nested structure of <a href="../../../../tf/TensorShape.html"><code>tf.TensorShape</code></a> objects
  corresponding to each component of an element of this dataset. If
  omitted, each component will have an unconstrainted shape.</li>
<li><b><code>output_classes</code></b>: (Optional.) A nested structure of Python <code>type</code> objects
  corresponding to each component of an element of this iterator. If
  omitted, each component is assumed to be of type <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a>.</li>
</ul>
<h4 id="returns_5">Returns:</h4>
<p>An <code>Iterator</code>.</p>
<h3 id="from_structure"><code>from_structure</code></h3>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="n">from_structure</span><span class="p">(</span>
    <span class="n">output_types</span><span class="p">,</span>
    <span class="n">output_shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">shared_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_classes</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Creates a new, uninitialized <code>Iterator</code> with the given structure.</p>
<p>This iterator-constructing method can be used to create an iterator that
is reusable with many different datasets.</p>
<p>The returned iterator is not bound to a particular dataset, and it has
no <code>initializer</code>. To initialize the iterator, run the operation returned by
<code>Iterator.make_initializer(dataset)</code>.</p>
<p>The following is an example</p>
<div class="codehilite"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="n">Iterator</span><span class="o">.</span><span class="n">from_structure</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([]))</span>

<span class="n">dataset_range</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">range_initializer</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">dataset_range</span><span class="p">)</span>

<span class="n">dataset_evens</span> <span class="o">=</span> <span class="n">dataset_range</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">evens_initializer</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">make_initializer</span><span class="p">(</span><span class="n">dataset_evens</span><span class="p">)</span>

<span class="c1"># Define a model based on the iterator; in this example, the model_fn</span>
<span class="c1"># is expected to take scalar tf.int64 Tensors as input (see</span>
<span class="c1"># the definition of &#39;iterator&#39; above).</span>
<span class="n">prediction</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">model_fn</span><span class="p">(</span><span class="n">iterator</span><span class="o">.</span><span class="n">get_next</span><span class="p">())</span>

<span class="c1"># Train for `num_epochs`, where for each epoch, we first iterate over</span>
<span class="c1"># dataset_range, and then iterate over dataset_evens.</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
  <span class="c1"># Initialize the iterator to `dataset_range`</span>
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">range_initializer</span><span class="p">)</span>
  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">pred</span><span class="p">,</span> <span class="n">loss_val</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">prediction</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">tf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">OutOfRangeError</span><span class="p">:</span>
      <span class="k">break</span>

  <span class="c1"># Initialize the iterator to `dataset_evens`</span>
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">evens_initializer</span><span class="p">)</span>
  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">pred</span><span class="p">,</span> <span class="n">loss_val</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">prediction</span><span class="p">,</span> <span class="n">loss</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">tf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">OutOfRangeError</span><span class="p">:</span>
      <span class="k">break</span>
</pre></div>


<h4 id="args_2">Args:</h4>
<ul>
<li><b><code>output_types</code></b>: A nested structure of <a href="../../../../tf/dtypes/DType.html"><code>tf.DType</code></a> objects corresponding to
  each component of an element of this dataset.</li>
<li><b><code>output_shapes</code></b>: (Optional.) A nested structure of <a href="../../../../tf/TensorShape.html"><code>tf.TensorShape</code></a> objects
  corresponding to each component of an element of this dataset. If
  omitted, each component will have an unconstrainted shape.</li>
<li><b><code>shared_name</code></b>: (Optional.) If non-empty, this iterator will be shared under
  the given name across multiple sessions that share the same devices
  (e.g. when using a remote server).</li>
<li><b><code>output_classes</code></b>: (Optional.) A nested structure of Python <code>type</code> objects
  corresponding to each component of an element of this iterator. If
  omitted, each component is assumed to be of type <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a>.</li>
</ul>
<h4 id="returns_6">Returns:</h4>
<p>An <code>Iterator</code>.</p>
<h4 id="raises_1">Raises:</h4>
<ul>
<li><b><code>TypeError</code></b>: If the structures of <code>output_shapes</code> and <code>output_types</code> are
  not the same.</li>
</ul>
<h3 id="get_next"><code>get_next</code></h3>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">get_next</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>


<p>Returns a nested structure of <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a>s representing the next element.</p>
<p>In graph mode, you should typically call this method <em>once</em> and use its
result as the input to another computation. A typical loop will then call
<code>tf.Session.run</code> on the result of that computation. The loop will terminate
when the <code>Iterator.get_next()</code> operation raises
<a href="../../../../tf/errors/OutOfRangeError.html"><code>tf.errors.OutOfRangeError</code></a>. The following skeleton shows how to use
this method when building a training loop:</p>
<div class="codehilite"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># A `tf.data.Dataset` object.</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">make_initializable_iterator</span><span class="p">()</span>
<span class="n">next_element</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>

<span class="c1"># Build a TensorFlow graph that does something with each element.</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">model_function</span><span class="p">(</span><span class="n">next_element</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># A `tf.compat.v1.train.Optimizer` object.</span>
<span class="n">train_op</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_op</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">tf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">OutOfRangeError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>


<p>NOTE: It is legitimate to call <code>Iterator.get_next()</code> multiple times, e.g.
when you are distributing different elements to multiple devices in a single
step. However, a common pitfall arises when users call <code>Iterator.get_next()</code>
in each iteration of their training loop. <code>Iterator.get_next()</code> adds ops to
the graph, and executing each op allocates resources (including threads); as
a consequence, invoking it in every iteration of a training loop causes
slowdown and eventual resource exhaustion. To guard against this outcome, we
log a warning when the number of uses crosses a fixed threshold of
suspiciousness.</p>
<h4 id="args_3">Args:</h4>
<ul>
<li><b><code>name</code></b>: (Optional.) A name for the created operation.</li>
</ul>
<h4 id="returns_7">Returns:</h4>
<p>A nested structure of <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> objects.</p>
<h3 id="make_initializer"><code>make_initializer</code></h3>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">make_initializer</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Returns a <a href="../../../../tf/Operation.html"><code>tf.Operation</code></a> that initializes this iterator on <code>dataset</code>.</p>
<h4 id="args_4">Args:</h4>
<ul>
<li><b><code>dataset</code></b>: A <code>Dataset</code> with compatible structure to this iterator.</li>
<li><b><code>name</code></b>: (Optional.) A name for the created operation.</li>
</ul>
<h4 id="returns_8">Returns:</h4>
<p>A <a href="../../../../tf/Operation.html"><code>tf.Operation</code></a> that can be run to initialize this iterator on the given
<code>dataset</code>.</p>
<h4 id="raises_2">Raises:</h4>
<ul>
<li><b><code>TypeError</code></b>: If <code>dataset</code> and this iterator do not have a compatible
  element structure.</li>
</ul>
<h3 id="string_handle"><code>string_handle</code></h3>

<p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/data/ops/iterator_ops.py">View source</a></p>
<div class="codehilite"><pre><span></span><span class="n">string_handle</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>


<p>Returns a string-valued <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> that represents this iterator.</p>
<h4 id="args_5">Args:</h4>
<ul>
<li><b><code>name</code></b>: (Optional.) A name for the created operation.</li>
</ul>
<h4 id="returns_9">Returns:</h4>
<p>A scalar <a href="../../../../tf/Tensor.html"><code>tf.Tensor</code></a> of type <a href="../../../../tf.html#string"><code>tf.string</code></a>.</p>
    </body>
    </html>
   